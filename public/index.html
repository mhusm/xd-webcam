<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">

    <!-- 1. Load platform support before any code that touches the DOM. -->
    <!--    <script src="http://129.132.114.114/js/remote.js"></script>  -->
    <script src="bower_components/webcomponentsjs/webcomponents.min.js"></script>
    <link rel="import" href="bower_components/polymer/polymer.html">
    <!-- 2. Load the component using an HTML Import -->

    <link rel="import" href="bower_components/xdmvcclient/polymer/xdmvc-synchronised.html">
    <link rel="import" href="bower_components/xdmvcclient/polymer/xdmvc-connect.html">
    <link rel="import" href="bower_components/xdmvcclient/polymer/xdmvc-connection.html">
    <link rel="import" href="bower_components/xdmvcclient/polymer/xdmvc-url-pairing.html">
    <meta name="viewport" content="width=device-width, user-scalable=no">

    <title></title>
</head>
<body>
<style>
    html,body {
        font-family: 'RobotoDraft', sans-serif;
        padding: 0;
        margin: 0;
    }

</style>

<dom-module id="my-app">
    <template>
        <xdmvc-connection ></xdmvc-connection>

        <xdmvc-synchronised id="sync"
                            objects='{{synced}}'
                            other-devices="{{others}}">
        </xdmvc-synchronised>
        <xdmvc-url-pairing connector="viewer" connectee="overview" ></xdmvc-url-pairing>
        <img src="[[src]]"/>
        <style>

            img {
                height: 100vh;
            }
        </style>

   </template>
</dom-module>
<script>

  function pad(num, size){ return ('0' + num).substr(-size); }

  HTMLImports.whenReady(function () {

      Polymer({
          is: "my-app",
          properties: {
              synced: {
                  type: Object,
                  value: function(){ return { center: {latitude: 47.3786, longitude: 8.5488},
                      zoom: {level:12},
                      distance: {value: 0},
                      bounds: {ne:{}, sw: {}},
                      map: {type: "roadmap"}
                  }} ,
                  notify: true
              },
              src: String

          },
          ready: function () {
              this.setNow();
              setInterval(this.setNow.bind(this), 10*60*1000)
          },
          setNow: function() {
          //    this.src = "http://storage.roundshot.com/5595515f75aba9.83008277/2016-11-25/09-10-00/2016-11-25-09-10-00_full.jpg";
              const tenMinutesAgo = new Date(Date.now() - 10*60*1000);
              const date = `${tenMinutesAgo.getFullYear()}-${pad(tenMinutesAgo.getMonth()+1,2)}-${pad(tenMinutesAgo.getDate(),2)}`;
              // minutes must be multiples of 10
              const time = `${tenMinutesAgo.getHours()}-${pad(Math.floor((tenMinutesAgo.getMinutes())/10)*10,2)}-00`;
              this.src = `http://storage.roundshot.com/5595515f75aba9.83008277/${date}/${time}/${date}-${time}_full.jpg`;
          }

      });
  });

</script>

<my-app></my-app>


</body>
</html>